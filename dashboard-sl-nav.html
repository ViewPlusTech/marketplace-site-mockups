<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inclusio – Dashboard</title>

  <!-- Your styles -->
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="dashboard-overrides.css" />

  <!-- Shoelace (no-build) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css" />
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>

  <!-- Reusable sidebar component -->
  <script type="module" src="inc-sidebar.js"></script>

  <style>
    /* Layout: desktop = fixed rail; mobile = drawer */
    .dashboard-layout { min-height: 100vh; }

    /* Common main content rules */
    .main-content { min-width: 0; }

    /* Desktop: sidebar visible as fixed rail on the left, menu button hidden */
    @media (min-width: 900px) {
      .dashboard-layout { display: flex; align-items: stretch; }
      inc-sidebar.sidebar-desktop { display: block; flex: 0 0 220px; order: -1; }
      inc-sidebar.sidebar-mobile { display: none; }
      #openMenu { display: none; }
    }

    /* Mobile: use drawer version; no fixed rail; show menu button */
    @media (max-width: 899px) {
      .dashboard-layout { display: block; }
      inc-sidebar.sidebar-desktop { display: none; }
      inc-sidebar.sidebar-mobile { display: block; }
      #openMenu {
        position: fixed;
        top: .75rem;
        left: .75rem;
        z-index: 10001;
      }
      /* Give main a little top padding so the button doesn't overlap content */
      .main-content { padding-top: 3rem; }
    }

    /* Small helpers carried over */
    .sr-only { position:absolute; left:-10000px; width:1px; height:1px; overflow:hidden; }
    .tool-cards { display:grid; grid-template-columns:repeat(auto-fit, minmax(260px,1fr)); gap:1rem; }
    .drop-zone p { margin: .25rem 0; }
    .maxw { max-width: 720px; }
    .section-head { display:flex; align-items:center; gap:.5rem; }
    .section-head .spacer { flex: 1; }
    .stack { display:flex; gap:.5rem; flex-wrap:wrap; align-items:flex-end; }
  </style>
</head>
<body>
  <!-- Mobile menu button (hidden on desktop via media query) -->
  <sl-button id="openMenu" variant="neutral" size="small" aria-label="Open menu">☰ Menu</sl-button>

  <div class="dashboard-layout">
    <!-- Main Content -->
    <main class="main-content maxw" id="main-content" tabindex="-1">
      <h1>Your Dashboard</h1>

      <p>What do you want to create today?</p>

      <!-- Shoelace Search -->
      <section aria-labelledby="search-heading">
        <h2 id="search-heading" class="sr-only">Search</h2>

        <div class="stack" style="max-width:600px;">
          <sl-input id="dashSearch" label="Search" placeholder="Search..." clearable></sl-input>
          <sl-button id="dashSearchGo" variant="primary">Search</sl-button>
          <!-- Demo "save" to trigger success toast -->
          <sl-button id="savePrefs" variant="neutral">Save preferences</sl-button>
        </div>

        <!-- SR announcements -->
        <p id="live" class="sr-only" aria-live="polite"></p>
      </section>

      <p class="tip">Tip: The more details you provide, the better!</p>

      <!-- Quick Tools -->
      <section class="tools" aria-labelledby="tools-heading">
        <div class="section-head">
          <h2 id="tools-heading">Quick Tools</h2>
          <div class="spacer" aria-hidden="true"></div>
          <sl-tooltip content="Keyboard shortcuts">
            <sl-icon-button name="keyboard" label="Keyboard shortcuts" id="openShortcuts"></sl-icon-button>
          </sl-tooltip>
        </div>

        <div class="tool-cards">
          <!-- Chart Generator (coming soon) -->
          <sl-card>
            <strong slot="header">Chart Generator</strong>
            <div>Create accessible charts quickly (bar, line, pie).</div>
            <div slot="footer" style="display:flex; gap:.5rem; justify-content:flex-end; align-items:center;">
              <sl-button size="small" variant="neutral" class="preview-btn" data-tool="Chart Generator">Details</sl-button>
              <sl-tooltip content="This feature is coming soon">
                <sl-button size="small" disabled aria-describedby="chart-coming-note">Coming soon</sl-button>
              </sl-tooltip>
            </div>
          </sl-card>

          <!-- Shape Generator (coming soon) -->
          <sl-card>
            <strong slot="header">Shape Generator</strong>
            <div>Create common tactile shapes and symbols.</div>
            <div slot="footer" style="display:flex; gap:.5rem; justify-content:flex-end; align-items:center;">
              <sl-button size="small" variant="neutral" class="preview-btn" data-tool="Shape Generator">Details</sl-button>
              <sl-tooltip content="This feature is coming soon">
                <sl-button size="small" disabled aria-describedby="shape-coming-note">Coming soon</sl-button>
              </sl-tooltip>
            </div>
          </sl-card>

          <!-- Convert Image (active example) -->
          <sl-card>
            <strong slot="header">Convert Image</strong>
            <div>Turn images into accessible formats and tactile outputs.</div>
            <div slot="footer" style="display:flex; gap:.5rem; justify-content:flex-end; align-items:center;">
              <sl-button size="small" variant="primary" id="jumpToUpload">Open uploader</sl-button>
            </div>
          </sl-card>
        </div>

        <!-- Extra context for SR users (don’t rely on tooltip alone) -->
        <p id="chart-coming-note" class="sr-only">Chart Generator is coming soon.</p>
        <p id="shape-coming-note" class="sr-only">Shape Generator is coming soon.</p>
      </section>

      <!-- Upload panel -->
      <section class="upload-panel" aria-labelledby="upload-heading">
        <h2 id="upload-heading" tabindex="-1">Convert your inaccessible files to accessible formats</h2>

        <sl-card class="drop-zone">
          <div>
            <p>Browse or drop files here</p>
            <label for="fileUpload" class="sr-only">Upload files</label>
            <input type="file" id="fileUpload" multiple accept=".png,.jpg,image/png,image/jpeg" />
            <p class="note">* Supported file types: .png, .jpg</p>
          </div>

          <!-- Progress + feedback -->
          <div style="margin-top: .75rem;">
            <sl-progress-bar id="uploadProgress" value="0" style="display:none;"></sl-progress-bar>
            <sl-alert id="uploadDone" variant="success" closable style="display:none; margin-top:.5rem;">
              <sl-icon slot="icon" name="check2-circle"></sl-icon>
              Upload complete. Proceed to <a href="review.html">Review</a>.
            </sl-alert>
          </div>
        </sl-card>
      </section>

      <!-- Shortcuts dialog -->
      <sl-dialog id="shortcutsDlg" label="Keyboard shortcuts">
        <ul>
          <li><strong>Alt+N</strong> (Windows): Focus sidebar navigation</li>
          <li><strong>Control+Option+N</strong> (Mac): Focus sidebar navigation</li>
          <li><strong>Tab / Shift+Tab</strong>: Move between controls</li>
          <li><strong>Esc</strong>: Close dialogs</li>
          <li><strong>Enter</strong>: Activate focused button or submit search</li>
        </ul>
        <sl-button slot="footer" variant="primary" onclick="shortcutsDlg.hide()">Close</sl-button>
      </sl-dialog>

      <!-- Tool preview dialog -->
      <sl-dialog id="previewDlg" label="Tool details">
        <p id="previewBody" class="usa-prose">This tool helps you create accessible outputs. More details coming soon.</p>
        <sl-button slot="footer" variant="neutral" onclick="previewDlg.hide()">Close</sl-button>
      </sl-dialog>

      <!-- Toasts (success & error) -->
      <sl-alert id="toastSuccess" variant="success" duration="3000" toast>
        <sl-icon slot="icon" name="check2-circle"></sl-icon>
        <strong>Saved.</strong> Your preferences were saved.
      </sl-alert>

      <sl-alert id="toastError" variant="danger" duration="4000" toast>
        <sl-icon slot="icon" name="exclamation-triangle"></sl-icon>
        <strong>Upload error.</strong> Only .png or .jpg files are supported.
      </sl-alert>
    </main>

    <!-- Desktop (fixed rail) -->
    <inc-sidebar class="sidebar-desktop"></inc-sidebar>

    <!-- Mobile (drawer) -->
    <inc-sidebar class="sidebar-mobile" mobile></inc-sidebar>
  </div>

  <script>
    // Open/close the mobile drawer
    const menuBtn = document.getElementById('openMenu');
    const mobileSidebar = document.querySelector('inc-sidebar.sidebar-mobile');
    menuBtn?.addEventListener('click', () => mobileSidebar?.toggleAttribute('open'));

    // Keyboard shortcut to focus sidebar nav (desktop: focus; mobile: open drawer then focus)
    function focusSidebar() {
      const desktop = document.querySelector('inc-sidebar.sidebar-desktop');
      const mobile  = document.querySelector('inc-sidebar.sidebar-mobile');
      const isDesktop = window.matchMedia('(min-width: 900px)').matches;

      if (isDesktop) {
        desktop?.focusFirstLink();
      } else {
        if (!mobile) return;
        if (!mobile.hasAttribute('open')) {
          mobile.setAttribute('open', '');         // opens drawer
          // Wait a frame so drawer is ready, then focus
          requestAnimationFrame(() => mobile.focusFirstLink());
        } else {
          mobile.focusFirstLink();
        }
      }
    }

    document.addEventListener('keydown', function(e) {
      // Windows: Alt+N
      if (e.altKey && e.key.toLowerCase() === 'n') {
        focusSidebar();
        e.preventDefault();
      }
      // Mac: Control+Option+N
      if (e.ctrlKey && e.altKey && e.key.toLowerCase() === 'n') {
        focusSidebar();
        e.preventDefault();
      }
    });

    // Search behavior
    const input = document.getElementById('dashSearch');
    const goBtn = document.getElementById('dashSearchGo');
    const savePrefs = document.getElementById('savePrefs');
    const live = document.getElementById('live');

    function runSearch() {
      const term = (input?.value || '').trim();
      live.textContent = term ? `Searching for: ${term}.` : 'Showing all items.';
      if (term) window.location.href = 'search-results.html';
    }
    goBtn?.addEventListener('click', runSearch);
    input?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') runSearch();
    });

    // Toast helpers (using .toast() so they go into the stack)
    const toastSuccess = document.getElementById('toastSuccess');
    const toastError = document.getElementById('toastError');

    function showSuccessToast(msg) {
      if (msg) toastSuccess.querySelector('strong').nextSibling.textContent = ` ${msg}`;
      toastSuccess.toast();
    }
    function showErrorToast(msg) {
      if (msg) toastError.querySelector('strong').nextSibling.textContent = ` ${msg}`;
      toastError.toast();
    }

    // Demo: Save preferences success toast
    savePrefs?.addEventListener('click', () => {
      showSuccessToast('Your preferences were saved.');
      live.textContent = 'Preferences saved.';
    });

    // Fake upload flow with validation + error toast
    const fileInput = document.getElementById('fileUpload');
    const prog = document.getElementById('uploadProgress');
    const done = document.getElementById('uploadDone');
    const allowed = ['image/png', 'image/jpeg', '.png', '.jpg'];

    fileInput?.addEventListener('change', () => {
      if (!fileInput.files || fileInput.files.length === 0) return;

      // Validate every file
      const bad = Array.from(fileInput.files).filter(f => {
        const nameOk = allowed.some(ext => f.name.toLowerCase().endsWith(ext));
        const typeOk = allowed.includes(f.type);
        return !(nameOk || typeOk);
      });

      if (bad.length) {
        fileInput.value = '';
        showErrorToast('Only .png or .jpg files are supported.');
        live.textContent = 'Upload error. Only PNG or JPG are supported.';
        return;
      }

      // Simulate progress
      done.style.display = 'none';
      prog.value = 0;
      prog.style.display = '';

      let v = 0;
      const t = setInterval(() => {
        v += 15;
        prog.value = v;
        live.textContent = `Uploading… ${v}%`;
        if (v >= 100) {
          clearInterval(t);
          prog.style.display = 'none';
          done.style.display = '';
          live.textContent = 'Upload complete. Continue to Review.';
        }
      }, 300);
    });

    // Shortcuts dialog
    const openShortcutsBtn = document.getElementById('openShortcuts');
    const shortcutsDlg = document.getElementById('shortcutsDlg');
    openShortcutsBtn?.addEventListener('click', () => shortcutsDlg.show());

    // Preview dialog for tools
    const previewDlg = document.getElementById('previewDlg');
    const previewBody = document.getElementById('previewBody');

    document.querySelectorAll('.preview-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const name = btn.getAttribute('data-tool') || 'Tool';
        previewBody.textContent = `${name} helps you create accessible outputs. Detailed settings and examples will be available soon.`;
        previewDlg.show();
      });
    });

    // Jump to upload
    const jump = document.getElementById('jumpToUpload');
    const uploadHeading = document.getElementById('upload-heading');
    jump?.addEventListener('click', () => {
      uploadHeading?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      uploadHeading?.focus?.();
      live.textContent = 'Moved to upload section.';
    });
  </script>
</body>
</html>
